# üåê Web UI and API Development Summary

## üìú Overview

Complete web interface providing intuitive configuration, launch, monitoring, and analysis of federated learning simulations. Modern UI layer over existing CLI framework without modifying core simulation logic.

**Key Benefits:**

- Visual configuration forms replace JSON editing
- Real-time status monitoring during execution
- Interactive result visualization with charts
- Historical simulation tracking and comparison
- Lower barrier to entry for researchers

---

## üèóÔ∏è Architecture

Three-tier architecture with clear separation of concerns:

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  React Frontend ‚îÇ (Port 5173)
‚îÇ   (Vite + Axios)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTTP/REST
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FastAPI Server ‚îÇ (Port 8000)
‚îÇ   (CORS enabled)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ subprocess
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FL Simulation  ‚îÇ
‚îÇ  (run_simulation‚îÇ
‚îÇ     .sh)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ†Ô∏è Backend API (FastAPI)

### Core File: `src/api/main.py`

**Key Features:**

- Type-safe request/response validation with Pydantic models
- Path traversal protection with `secure_join()`
- In-memory process tracking for status monitoring
- CORS configuration for frontend communication

### API Endpoints

#### `GET /api/simulations`

List all historical simulation runs from `out/` directory.

**Response:** Array of simulation metadata (ID, strategy, rounds, clients)

#### `POST /api/simulations`

Launch a new simulation with provided configuration.

**Process:**

1. Generate unique timestamp-based simulation ID
2. Create output directory
3. Write config.json
4. Launch run_simulation.sh as subprocess
5. Store process handle for monitoring

**Returns:** `{simulation_id: string, status: string}`

#### `GET /api/simulations/{id}`

Get detailed information for a specific simulation.

**Returns:** Full config + list of result files (CSVs, PDFs, JSON)

#### `GET /api/simulations/{id}/status`

Real-time status polling for active simulations.

**Returns:** `{status: "pending|running|completed|failed", progress: 0.0-1.0}`

**Status Logic:**

- Checks `running_processes` dict for active subprocess
- Uses `process.poll()` to determine if still running
- Falls back to filesystem checks (graceful server restart handling)
- Detects completion by presence of result files (PDFs/CSVs)

#### `GET /api/results/{filename}`

Download result files with path traversal protection.

**Security:** Validates filename, prevents directory traversal

#### `GET /api/simulations/{id}/plot-data`

Return JSON plot data for interactive frontend visualization.

**Returns:** Plot data from `plot_data_*.json` files generated by simulation

**Integration:** Powers InteractivePlots component for real-time chart rendering

### Implementation Details

**CORS Configuration:**

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173", "http://127.0.0.1:5173", "http://localhost:5174"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Process Tracking:**

```python
running_processes: Dict[str, subprocess.Popen] = {}
```

- Stores subprocess handles when launching simulations
- Enables real-time status checks via `process.poll()`
- Handles lost on server restart (gracefully handled by fallback logic)

**CSV Encoding Compatibility:**

- Added `encoding="latin-1"` to pandas CSV reads
- Handles CSV files with non-UTF8 characters (special symbols, extended ASCII)
- Prevents UTF-8 decode errors on simulation outputs

**Python 3.9+ Compatibility:**

- Uses `Union[int, str]` instead of `int | str` (PEP 604 syntax requires 3.10+)
- Ensures compatibility across Python 3.9-3.11

---

## üé® Frontend (React + Vite)

### Project Structure

```text
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx          # Home page with simulation list
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewSimulation.jsx      # Configuration form
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SimulationDetails.jsx  # Results viewer
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorBoundary.jsx      # Error handling wrapper
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useApi.js              # Custom React hooks for API calls
‚îÇ   ‚îú‚îÄ‚îÄ api.js                     # Axios HTTP client
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx                    # Main routing component
‚îÇ   ‚îî‚îÄ‚îÄ main.jsx                   # React entry point
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ vite.config.js
```

### Key Components

#### `Dashboard.jsx`

Landing page showing all simulations with filtering and sorting.

**Features:**

- Fetches simulation list from API on mount
- Sortable table display
- Filters by strategy, status, date
- Navigation to detail view and new simulation form

#### `NewSimulation.jsx`

Interactive configuration form with 40+ parameters.

**Features:**

- Organized sections (Basic, Client Config, Advanced)
- Conditional fields (e.g., PID params only for PID strategy)
- Form validation (required fields, numeric ranges)
- Default values and tooltips

#### `SimulationDetails.jsx`

Results viewer with inline visualization.

**Features:**

- Full configuration display as formatted JSON
- File list with download buttons
- Inline plots (accuracy, loss, client metrics)
- Interactive charts with Recharts library
- Auto-refresh status polling (every 3 seconds for active simulations)

#### `ErrorBoundary.jsx`

React error boundary for graceful error handling.

### API Client: `api.js`

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8000',
  headers: { 'Content-Type': 'application/json' }
});

export const getSimulations = () => api.get('/api/simulations');
export const createSimulation = (config) => api.post('/api/simulations', config);
export const getSimulationDetails = (id) => api.get(`/api/simulations/${id}`);
export const getSimulationStatus = (id) => api.get(`/api/simulations/${id}/status`);
```

### Dependencies

```json
{
  "react": "^18.3.1",
  "react-router-dom": "^7.1.3",  // Client-side routing
  "axios": "^1.7.9",              // HTTP requests
  "recharts": "^2.15.0",          // Chart visualizations
  "vite": "^6.0.5"                // Build tool
}
```

---

## üîß Supporting Infrastructure

### Plot Data JSON Export

**File:** `src/output_handlers/new_plot_handler.py`

**New Function:** `export_plot_data_json()`

- Exports plot data as JSON alongside PDF plots
- Contains all plot metrics (accuracy, loss, client histories, removal thresholds)
- Data structure includes per-client metrics and round-level aggregates
- Consumed by `/api/simulations/{id}/plot-data` endpoint

**Robustness Improvements:**

- Empty list validation before plotting
- Dimension matching with `min_length` to prevent index errors
- Prevents crashes when rounds/metrics have different lengths

### Output Directory Configuration

**Files:** `src/output_handlers/directory_handler.py`, `src/simulation_runner.py`

**Changes:**

- Added optional `output_dir` parameter to DirectoryHandler
- API-initiated simulations save to `out/api_run_*` directories
- Backward compatible: defaults to timestamp-based directory when `output_dir=None`

### API Status Detection

**File:** `src/api/main.py`

**Improvements:**

- Updated result file detection from PNG/CSV to PDF/CSV (correct file types)
- Check for result files before treating non-zero exit as failure
- More accurate status reporting for completed simulations

### Core Strategy Support

**Files:** `src/federated_simulation.py`, `src/config_loaders/validate_strategy_config.py`

**Changes:**

- Added fedavg strategy support (vanilla Flower FedAvg as baseline)
- Frontend defaults to fedavg for simplicity

### Client Sample Counts

**File:** `src/client_models/flower_client.py`

**Bug Fix:**

- Fixed `fit()` and `evaluate()` to return dataset size, not batch count
- `len(self.trainloader)` returns batch count (incorrect)
- `len(loader.dataset)` returns sample count (correct)
- Flower framework needs sample counts for weighted averaging
- Prevented ZeroDivisionError in aggregation

---

## üöÄ Development Workflow

### Development Script: `start-dev.sh`

```bash
#!/bin/bash
# Start FastAPI server and React frontend concurrently
uvicorn src.api.main:app --reload &
cd frontend && npm run dev
```

**Usage:** `./start-dev.sh` from project root

### Manual Startup (Parallel)

```bash
# Terminal 1: API server
uvicorn src.api.main:app --reload --port 8000

# Terminal 2: Frontend dev server
cd frontend && npm run dev
```

**Frontend URL:** <http://localhost:5173>
**Backend URL:** <http://localhost:8000>
**API Docs:** <http://localhost:8000/docs> (auto-generated by FastAPI)

---

## üìä Code Changes Summary

**New Files:**

- Backend: `src/api/main.py`
- Frontend: Core components and infrastructure
- Infrastructure: `package.json`, `start-dev.sh`

**Modified Files:**

- `src/federated_simulation.py`: fedavg support
- `src/config_loaders/validate_strategy_config.py`: fedavg enum
- `src/client_models/flower_client.py`: sample count fixes
- `src/output_handlers/new_plot_handler.py`: JSON export, robustness
- `src/output_handlers/directory_handler.py`: output_dir parameter

**Code Formatting:**

- Python files reformatted with `ruff`
- No functional changes

---

## üèÅ Summary

Web UI provides major usability enhancement while preserving core functionality:

**‚úÖ Maintained:**

- No changes to core FL algorithms
- Backward compatibility with CLI usage
- Output format unchanged (CSVs, plots)
- Configuration schema preserved

**üìà Enhanced:**

- Accessibility for non-technical users
- Better experiment tracking
- Improved result visualization
- Foundation for collaborative research platform
